<!DOCTYPE html>
<html>
<head>
    <title>Email Auto-Responder</title>
</head>
<body>
    <h1>Email Auto-Responder</h1>
    <p>This is a webhook endpoint for processing Bokun.io booking notifications.</p>
    <h2>Bookings</h2>
    <div id="bookings-table"></div>
    <div id="pagination-controls"></div>
    <script>
      let currentPage = 1;
      const limit = 20;
      async function fetchBookings(page = 1) {
        const res = await fetch(`/api/bookings?page=${page}&limit=${limit}`);
        const data = await res.json();
        renderTable(data.bookings);
        renderPagination(data.page, data.limit, data.total);
      }
      function renderTable(bookings) {
        let html = '<table border="1" cellpadding="5"><tr><th>Booking #</th><th>Tour Date</th><th>Customer Name</th><th>Program</th><th>OP</th><th>Customer</th></tr>';
        for (const b of bookings) {
          html += `<tr><td>${b.booking_number}</td><td>${b.tour_date ? b.tour_date.substring(0,10) : ''}</td><td>${b.customer_name || ''}</td><td>${b.program || ''}</td><td>${b.op ? '✓' : 'X'}</td><td>${b.customer ? '✓' : 'X'}</td></tr>`;
        }
        html += '</table>';
        document.getElementById('bookings-table').innerHTML = html;
      }
      function renderPagination(page, limit, total) {
        const totalPages = Math.ceil(total / limit);
        let html = '';
        if (page > 1) html += `<button onclick="gotoPage(${page-1})">Previous</button>`;
        html += ` Page ${page} of ${totalPages} `;
        if (page < totalPages) html += `<button onclick="gotoPage(${page+1})">Next</button>`;
        document.getElementById('pagination-controls').innerHTML = html;
      }
      function gotoPage(page) {
        currentPage = page;
        fetchBookings(page);
      }
      fetchBookings();
    </script>
</body>
</html> 